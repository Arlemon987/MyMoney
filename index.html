<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Money</title>

<meta name="theme-color" content="#764ba2">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="My Money">

<link rel="apple-touch-icon" href="icon.png">
<link rel="apple-touch-startup-image" href="splash.png">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

<style>
*{box-sizing:border-box}
body{margin:0;font-family:Segoe UI;background:linear-gradient(135deg,#667eea,#764ba2)}
.container{max-width:1100px;margin:auto;padding:20px}
header{text-align:center;color:white;margin-bottom:20px}
header h1{margin:0;font-size:28px}

.section{
background:white;
padding:20px;
border-radius:16px;
margin-bottom:20px;
box-shadow:0 8px 20px rgba(0,0,0,0.08)
}

.summary-grid{
display:grid;
gap:15px;
grid-template-columns:repeat(auto-fit,minmax(250px,1fr))
}

.card{padding:15px;border-radius:12px;color:white}
.daily{background:#36b9cc}
.weekly{background:#f6c23e}
.monthly{background:#e74a3b}

button{
padding:10px;
border:none;
border-radius:8px;
font-weight:bold;
cursor:pointer
}

.income-btn{background:#1cc88a;color:white}
.expense-btn{background:#e74a3b;color:white}
.reset-btn{background:#6c757d;color:white;width:100%;margin-top:10px}

.lock-screen{
position:fixed;
top:0;left:0;
width:100%;height:100%;
background:#111;
color:white;
display:flex;
align-items:center;
justify-content:center;
flex-direction:column;
z-index:9999
}

input{
width:100%;
padding:10px;
margin-bottom:10px
}

canvas{max-width:100%}
</style>
</head>
<body>

<div id="lockScreen" class="lock-screen">
<h2>Unlock My Money</h2>
<input type="password" id="pinInput" placeholder="Enter PIN">
<button onclick="unlockPIN()">Unlock</button>
<button onclick="unlockBiometric()">Use Face ID</button>
</div>

<div class="container">

<header><h1>My Money</h1></header>

<div class="section">
<h3>Profile</h3>
<input type="text" id="name" placeholder="Your Name">
<input type="text" id="currency" placeholder="Currency">
<input type="password" id="setPin" placeholder="Set PIN">
<button onclick="saveProfile()">Save Profile</button>
<button onclick="exportData()">Export Backup</button>
<input type="file" onchange="importData(event)">
</div>

<div class="section">
<h3>Summary</h3>
<div class="summary-grid">
<div class="card daily">
<p>Income: <span id="dailyIncome">0</span></p>
<p>Expense: <span id="dailyExpense">0</span></p>
<p>Balance: <span id="dailyBalance">0</span></p>
</div>
<div class="card weekly">
<p>Income: <span id="weeklyIncome">0</span></p>
<p>Expense: <span id="weeklyExpense">0</span></p>
<p>Balance: <span id="weeklyBalance">0</span></p>
</div>
<div class="card monthly">
<p>Income: <span id="monthlyIncome">0</span></p>
<p>Expense: <span id="monthlyExpense">0</span></p>
<p>Balance: <span id="monthlyBalance">0</span></p>
</div>
</div>
</div>

<div class="section">
<form onsubmit="addIncome(event)">
<input type="number" id="incomeAmount" placeholder="Income Amount" required>
<button class="income-btn">Add Income</button>
</form>

<form onsubmit="addExpense(event)">
<input type="number" id="expenseAmount" placeholder="Expense Amount" required>
<button class="expense-btn">Add Expense</button>
</form>

<button class="reset-btn" onclick="resetTransactions()">Reset Transactions</button>
</div>

<div class="section">
<canvas id="chart"></canvas>
</div>

</div>

<script>

let profile=JSON.parse(localStorage.getItem("profile"))||{name:"User",currency:"৳",pin:null}
let encrypted=localStorage.getItem("transactions")
let transactions=[]

if(encrypted){
try{
let bytes=CryptoJS.AES.decrypt(encrypted,profile.pin||"default")
transactions=JSON.parse(bytes.toString(CryptoJS.enc.Utf8))
}catch(e){transactions=[]}
}

function saveProfile(){
profile.name=name.value||"User"
profile.currency=currency.value||"৳"
if(setPin.value) profile.pin=setPin.value
localStorage.setItem("profile",JSON.stringify(profile))
alert("Profile Saved")
}

function saveData(){
let cipher=CryptoJS.AES.encrypt(JSON.stringify(transactions),profile.pin||"default").toString()
localStorage.setItem("transactions",cipher)
}

function addIncome(e){
e.preventDefault()
transactions.push({type:"income",amount:parseFloat(incomeAmount.value),date:new Date()})
saveData()
render()
}

function addExpense(e){
e.preventDefault()
transactions.push({type:"expense",amount:parseFloat(expenseAmount.value),date:new Date()})
saveData()
render()
}

function resetTransactions(){
if(confirm("Delete all transactions?")){
transactions=[]
localStorage.removeItem("transactions")
render()
}
}

function render(){
let today=new Date()
let weekAgo=new Date();weekAgo.setDate(today.getDate()-7)
let dI=0,dE=0,wI=0,wE=0,mI=0,mE=0

transactions.forEach(tx=>{
let txDate=new Date(tx.date)
if(txDate.toDateString()===today.toDateString())
tx.type==="income"?dI+=tx.amount:dE+=tx.amount
if(txDate>=weekAgo)
tx.type==="income"?wI+=tx.amount:wE+=tx.amount
if(txDate.getMonth()===today.getMonth())
tx.type==="income"?mI+=tx.amount:mE+=tx.amount
})

dailyIncome.innerText=profile.currency+dI
dailyExpense.innerText=profile.currency+dE
dailyBalance.innerText=profile.currency+(dI-dE)

weeklyIncome.innerText=profile.currency+wI
weeklyExpense.innerText=profile.currency+wE
weeklyBalance.innerText=profile.currency+(wI-wE)

monthlyIncome.innerText=profile.currency+mI
monthlyExpense.innerText=profile.currency+mE
monthlyBalance.innerText=profile.currency+(mI-mE)

renderChart(mI,mE)
}

function renderChart(i,e){
if(window.myChart)window.myChart.destroy()
window.myChart=new Chart(chart,{
type:"doughnut",
data:{labels:["Income","Expense"],
datasets:[{data:[i,e],backgroundColor:["#1cc88a","#e74a3b"]}]}
})
}

function unlockPIN(){
if(profile.pin===null || pinInput.value===profile.pin){
lockScreen.style.display="none"
}else alert("Wrong PIN")
}

async function unlockBiometric(){
if(window.PublicKeyCredential){
try{
await navigator.credentials.get({
publicKey:{
challenge:new Uint8Array(32),
timeout:60000,
userVerification:"required"
}
})
lockScreen.style.display="none"
}catch(e){alert("Authentication Failed")}
}else alert("Not Supported")
}

function exportData(){
let blob=new Blob([JSON.stringify({transactions,profile})],{type:"application/json"})
let url=URL.createObjectURL(blob)
let a=document.createElement("a")
a.href=url
a.download="my-money-backup.json"
a.click()
}

function importData(event){
let file=event.target.files[0]
let reader=new FileReader()
reader.onload=function(e){
let data=JSON.parse(e.target.result)
transactions=data.transactions||[]
profile=data.profile||profile
localStorage.setItem("profile",JSON.stringify(profile))
saveData()
render()
}
reader.readAsText(file)
}

render()

if('serviceWorker' in navigator){
navigator.serviceWorker.register(URL.createObjectURL(new Blob([`
self.addEventListener('install',e=>self.skipWaiting());
self.addEventListener('fetch',e=>{});
`],{type:'text/javascript'})))
}

const manifest={
name:"My Money",
short_name:"My Money",
start_url:".",
display:"standalone",
background_color:"#764ba2",
theme_color:"#764ba2",
icons:[{src:"icon.png",sizes:"192x192",type:"image/png"}]
}
const blob=new Blob([JSON.stringify(manifest)],{type:'application/json'})
const url=URL.createObjectURL(blob)
const link=document.createElement("link")
link.rel="manifest"
link.href=url
document.head.appendChild(link)

</script>
</body>
</html>
