<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Money</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

<style>
*{box-sizing:border-box}
body{
margin:0;
font-family:Segoe UI;
background:linear-gradient(135deg,#667eea,#764ba2);
}

/* LOCK SCREEN */

.lock-screen{
position:fixed;
top:0;left:0;
width:100%;height:100%;
background:linear-gradient(135deg,#1e3c72,#2a5298);
display:flex;
align-items:center;
justify-content:center;
z-index:9999;
}

.lock-box{
background:rgba(255,255,255,0.1);
backdrop-filter:blur(20px);
padding:40px;
border-radius:20px;
width:90%;
max-width:350px;
text-align:center;
color:white;
box-shadow:0 20px 40px rgba(0,0,0,0.3);
}

.lock-box input{
width:100%;
padding:12px;
border:none;
border-radius:10px;
margin-bottom:15px;
font-size:16px;
}

.lock-btn{
width:100%;
padding:12px;
border:none;
border-radius:10px;
font-weight:bold;
cursor:pointer;
margin-bottom:10px;
}

.primary{background:#1cc88a;color:white}
.secondary{background:#36b9cc;color:white}

/* APP */

.container{max-width:1100px;margin:auto;padding:20px}
.section{
background:white;
padding:20px;
border-radius:16px;
margin-bottom:20px;
box-shadow:0 8px 20px rgba(0,0,0,0.08)
}

.summary-grid{
display:grid;
gap:15px;
grid-template-columns:repeat(auto-fit,minmax(280px,1fr))
}

.card{
padding:15px;
border-radius:12px;
color:white;
}

.today{background:#36b9cc}
.week{background:#f6c23e}
.month{background:#e74a3b}
.profit{background:#1cc88a}

button{
padding:10px;
border:none;
border-radius:8px;
font-weight:bold;
cursor:pointer
}

.income-btn{background:#1cc88a;color:white}
.expense-btn{background:#e74a3b;color:white}
.reset-btn{background:#6c757d;color:white;width:100%;margin-top:10px}

input{
width:100%;
padding:10px;
margin-bottom:10px
}

.transaction{
display:flex;
justify-content:space-between;
border-bottom:1px solid #eee;
padding:6px 0;
font-size:14px;
}

canvas{max-width:100%}
</style>
</head>
<body>

<!-- LOCK -->
<div id="lockScreen" class="lock-screen">
<div class="lock-box">
<h2 id="lockTitle">Set Security PIN</h2>
<input type="password" id="pinInput" placeholder="Enter 4 digit PIN">
<button class="lock-btn primary" onclick="handleLock()">Continue</button>
<button class="lock-btn secondary" onclick="unlockBiometric()" id="bioBtn">Use Face ID</button>
</div>
</div>

<!-- APP -->
<div id="appContent" class="container" style="display:none">

<h1 style="color:white;text-align:center">My Money</h1>

<div class="section">
<h3>Add Income</h3>
<form onsubmit="addIncome(event)">
<input type="text" id="incomeDesc" placeholder="Income Description" required>
<input type="number" id="incomeAmount" placeholder="Amount" required>
<button class="income-btn">Add Income</button>
</form>
</div>

<div class="section">
<h3>Add Expenditure</h3>
<form onsubmit="addExpense(event)">
<input type="text" id="expenseDesc" placeholder="Expense Description" required>
<input type="number" id="expenseAmount" placeholder="Amount" required>
<button class="expense-btn">Add Expense</button>
</form>
<button class="reset-btn" onclick="resetTransactions()">Reset Transactions</button>
</div>

<div class="section">
<h3>Summary</h3>
<div class="summary-grid">

<div class="card today">
<h4>Today</h4>
<p>Income: <span id="dailyIncome">0</span></p>
<p>Expense: <span id="dailyExpense">0</span></p>
<p>Balance: <span id="dailyBalance">0</span></p>
</div>

<div class="card week">
<h4>This Week</h4>
<p>Income: <span id="weeklyIncome">0</span></p>
<p>Expense: <span id="weeklyExpense">0</span></p>
<p>Balance: <span id="weeklyBalance">0</span></p>
</div>

<div class="card month">
<h4>This Month</h4>
<p>Income: <span id="monthlyIncome">0</span></p>
<p>Expense: <span id="monthlyExpense">0</span></p>
<p>Balance: <span id="monthlyBalance">0</span></p>
</div>

<div class="card profit">
<h4>Net Profit This Month</h4>
<p id="profitValue">0</p>
</div>

</div>
</div>

<div class="section">
<h3>Transactions</h3>
<div id="transactionList"></div>
</div>

<div class="section">
<canvas id="chart"></canvas>
</div>

</div>

<script>

let profile=JSON.parse(localStorage.getItem("profile"))||{pin:null}
let encrypted=localStorage.getItem("transactions")
let transactions=[]

if(encrypted && profile.pin){
try{
let bytes=CryptoJS.AES.decrypt(encrypted,profile.pin)
transactions=JSON.parse(bytes.toString(CryptoJS.enc.Utf8))
}catch(e){transactions=[]}
}

function handleLock(){
let entered=pinInput.value

if(!profile.pin){
if(entered.length<4){alert("Minimum 4 digits");return}
profile.pin=entered
localStorage.setItem("profile",JSON.stringify(profile))
unlockApp()
}else{
if(entered===profile.pin){unlockApp()}
else alert("Wrong PIN")
}
}

function unlockApp(){
lockScreen.style.display="none"
appContent.style.display="block"
render()
}

async function unlockBiometric(){
if(!profile.pin){alert("Set PIN first");return}
if(window.PublicKeyCredential){
try{
await navigator.credentials.get({
publicKey:{challenge:new Uint8Array(32),timeout:60000,userVerification:"required"}
})
unlockApp()
}catch(e){alert("Authentication Failed")}
}
}

function saveData(){
let cipher=CryptoJS.AES.encrypt(JSON.stringify(transactions),profile.pin).toString()
localStorage.setItem("transactions",cipher)
}

function addIncome(e){
e.preventDefault()
transactions.push({type:"income",desc:incomeDesc.value,amount:parseFloat(incomeAmount.value),date:new Date()})
saveData(); render()
e.target.reset()
}

function addExpense(e){
e.preventDefault()
transactions.push({type:"expense",desc:expenseDesc.value,amount:parseFloat(expenseAmount.value),date:new Date()})
saveData(); render()
e.target.reset()
}

function resetTransactions(){
if(confirm("Delete all transactions?")){
transactions=[]
localStorage.removeItem("transactions")
render()
}
}

function render(){
let today=new Date()
let weekAgo=new Date();weekAgo.setDate(today.getDate()-7)
let dI=0,dE=0,wI=0,wE=0,mI=0,mE=0

transactionList.innerHTML=""

transactions.slice().reverse().forEach(tx=>{
let txDate=new Date(tx.date)

if(txDate.toDateString()===today.toDateString())
tx.type==="income"?dI+=tx.amount:dE+=tx.amount

if(txDate>=weekAgo)
tx.type==="income"?wI+=tx.amount:wE+=tx.amount

if(txDate.getMonth()===today.getMonth())
tx.type==="income"?mI+=tx.amount:mE+=tx.amount

transactionList.innerHTML+=`
<div class="transaction">
<span>${tx.desc}</span>
<span>${tx.type==="income"?"+" : "-"}${tx.amount}</span>
</div>`
})

dailyIncome.innerText=dI
dailyExpense.innerText=dE
dailyBalance.innerText=dI-dE

weeklyIncome.innerText=wI
weeklyExpense.innerText=wE
weeklyBalance.innerText=wI-wE

monthlyIncome.innerText=mI
monthlyExpense.innerText=mE
monthlyBalance.innerText=mI-mE

profitValue.innerText=mI-mE

renderChart(mI,mE)
}

function renderChart(i,e){
if(window.myChart)window.myChart.destroy()
window.myChart=new Chart(chart,{
type:"doughnut",
data:{labels:["Income","Expense"],
datasets:[{data:[i,e],backgroundColor:["#1cc88a","#e74a3b"]}]}
})
}

if(profile.pin){
lockTitle.innerText="Unlock My Money"
}else{
bioBtn.style.display="none"
}
</script>
</body>
</html>
