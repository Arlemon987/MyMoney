<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Money</title>

<meta name="theme-color" content="#764ba2">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<link rel="apple-touch-icon" href="icon.png">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(135deg,#667eea,#764ba2);
}

.container {
  max-width: 1100px;
  margin: auto;
  padding: 20px;
}

header {
  text-align: center;
  color: white;
  margin-bottom: 25px;
}

header h1 {
  margin: 0;
  font-size: 34px;
  font-weight: 700;
}

/* PROFILE */

.profile-card {
  background: rgba(255,255,255,0.15);
  backdrop-filter: blur(15px);
  border-radius: 20px;
  padding: 25px;
  color: white;
  margin-bottom: 25px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.2);
}

.profile-header {
  display: flex;
  align-items: center;
  gap: 15px;
  margin-bottom: 15px;
}

.avatar {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background: white;
  color: #764ba2;
  font-size: 24px;
  font-weight: bold;
  display: flex;
  align-items: center;
  justify-content: center;
}

.profile-card input {
  width: 100%;
  padding: 10px;
  border-radius: 8px;
  border: none;
  margin-bottom: 10px;
}

.save-profile {
  background: #1cc88a;
  color: white;
  width: 100%;
  padding: 10px;
  border: none;
  border-radius: 8px;
  font-weight: bold;
}

.section {
  background: white;
  padding: 20px;
  border-radius: 16px;
  margin-bottom: 20px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.08);
}

.summary-grid {
  display: grid;
  gap: 15px;
  grid-template-columns: repeat(auto-fit,minmax(250px,1fr));
}

.card {
  padding: 15px;
  border-radius: 12px;
  color: white;
}

.daily { background:#36b9cc; }
.weekly { background:#f6c23e; }
.monthly { background:#e74a3b; }

.forms {
  display: grid;
  gap: 15px;
  grid-template-columns: repeat(auto-fit,minmax(280px,1fr));
}

form input {
  width:100%;
  padding:10px;
  margin-bottom:10px;
}

button {
  padding:10px;
  border:none;
  border-radius:8px;
  font-weight:bold;
  cursor:pointer;
}

.income-btn { background:#1cc88a; color:white; }
.expense-btn { background:#e74a3b; color:white; }
.reset-btn { background:#6c757d; color:white; width:100%; margin-top:15px; }

.transaction-item {
  display:flex;
  justify-content:space-between;
  padding:8px 0;
  border-bottom:1px solid #eee;
  font-size:14px;
}

canvas { max-width:100%; }

@media(max-width:600px){
  header h1 { font-size:26px; }
}
</style>
</head>
<body>

<div class="container">

<header>
  <h1>My Money</h1>
</header>

<div class="profile-card">
  <div class="profile-header">
    <div class="avatar" id="avatar">U</div>
    <div>
      <div id="displayName" style="font-weight:bold;font-size:18px;">User</div>
      <div style="font-size:13px;opacity:0.8;">Personal Finance Dashboard</div>
    </div>
  </div>

  <input type="text" id="name" placeholder="Your Name">
  <input type="text" id="currency" placeholder="Currency Symbol (৳)">
  <button class="save-profile" onclick="saveProfile()">Save Profile</button>
</div>

<div class="section">
  <h2>Summary</h2>
  <div class="summary-grid">
    <div class="card daily">
      <h3>Today</h3>
      <p>Income: <span id="dailyIncome">0</span></p>
      <p>Expenditures: <span id="dailyExpense">0</span></p>
      <p>Balance: <span id="dailyBalance">0</span></p>
    </div>
    <div class="card weekly">
      <h3>This Week</h3>
      <p>Income: <span id="weeklyIncome">0</span></p>
      <p>Expenditures: <span id="weeklyExpense">0</span></p>
      <p>Balance: <span id="weeklyBalance">0</span></p>
    </div>
    <div class="card monthly">
      <h3>This Month</h3>
      <p>Income: <span id="monthlyIncome">0</span></p>
      <p>Expenditures: <span id="monthlyExpense">0</span></p>
      <p>Balance: <span id="monthlyBalance">0</span></p>
    </div>
  </div>
</div>

<div class="section">
  <div class="forms">
    <form id="incomeForm">
      <h3>Add Income</h3>
      <input type="text" id="incomeDesc" required>
      <input type="number" id="incomeAmount" required>
      <button class="income-btn">Add Income</button>
    </form>

    <form id="expenseForm">
      <h3>Add Expense</h3>
      <input type="text" id="expenseDesc" required>
      <input type="number" id="expenseAmount" required>
      <button class="expense-btn">Add Expense</button>
    </form>
  </div>

  <button class="reset-btn" onclick="resetTransactions()">Reset All Transactions</button>
</div>

<div class="section">
  <canvas id="chart"></canvas>
</div>

</div>

<script>
let transactions = JSON.parse(localStorage.getItem("transactions")) || [];
let profile = JSON.parse(localStorage.getItem("profile")) || {name:"User",currency:"৳"};

document.getElementById("name").value = profile.name;
document.getElementById("currency").value = profile.currency;

function saveProfile(){
  profile.name = name.value || "User";
  profile.currency = currency.value || "৳";
  localStorage.setItem("profile",JSON.stringify(profile));
  renderProfile();
}

function renderProfile(){
  displayName.innerText = profile.name;
  avatar.innerText = profile.name.charAt(0).toUpperCase();
}

function saveData(){
  localStorage.setItem("transactions",JSON.stringify(transactions));
}

function addTransaction(type,desc,amount){
  transactions.push({ type, desc, amount:parseFloat(amount), date:new Date().toISOString() });
  saveData();
  render();
}

incomeForm.addEventListener("submit",e=>{
  e.preventDefault();
  addTransaction("income",incomeDesc.value,incomeAmount.value);
  incomeForm.reset();
});

expenseForm.addEventListener("submit",e=>{
  e.preventDefault();
  addTransaction("expense",expenseDesc.value,expenseAmount.value);
  expenseForm.reset();
});

function resetTransactions(){
  if(confirm("Delete all transactions?")){
    transactions=[];
    localStorage.removeItem("transactions");
    render();
  }
}

function render(){
  let monthIncome=0,monthExpense=0;
  let todayIncome=0,todayExpense=0;
  let weekIncome=0,weekExpense=0;

  let today=new Date();
  let weekAgo=new Date();
  weekAgo.setDate(today.getDate()-7);

  transactions.forEach(tx=>{
    let txDate=new Date(tx.date);

    if(txDate.toDateString()===today.toDateString()){
      tx.type==="income"?todayIncome+=tx.amount:todayExpense+=tx.amount;
    }

    if(txDate>=weekAgo){
      tx.type==="income"?weekIncome+=tx.amount:weekExpense+=tx.amount;
    }

    if(txDate.getMonth()===today.getMonth() &&
       txDate.getFullYear()===today.getFullYear()){
      tx.type==="income"?monthIncome+=tx.amount:monthExpense+=tx.amount;
    }
  });

  function setVal(id,val){
    document.getElementById(id).innerText=profile.currency+val;
  }

  setVal("dailyIncome",todayIncome);
  setVal("dailyExpense",todayExpense);
  setVal("dailyBalance",todayIncome-todayExpense);

  setVal("weeklyIncome",weekIncome);
  setVal("weeklyExpense",weekExpense);
  setVal("weeklyBalance",weekIncome-weekExpense);

  setVal("monthlyIncome",monthIncome);
  setVal("monthlyExpense",monthExpense);
  setVal("monthlyBalance",monthIncome-monthExpense);

  renderChart(monthIncome,monthExpense);
}

function renderChart(income,expense){
  if(window.myChart) window.myChart.destroy();
  window.myChart=new Chart(document.getElementById("chart"),{
    type:"doughnut",
    data:{
      labels:["Income","Expense"],
      datasets:[{
        data:[income,expense],
        backgroundColor:["#1cc88a","#e74a3b"]
      }]
    }
  });
}

renderProfile();
render();

/* AUTO CREATE MANIFEST + SERVICE WORKER */

if ('serviceWorker' in navigator) {

  const manifest = {
    name: "My Money",
    short_name: "My Money",
    start_url: ".",
    display: "standalone",
    background_color: "#764ba2",
    theme_color: "#764ba2",
    icons: [{
      src: "icon.png",
      sizes: "192x192",
      type: "image/png"
    }]
  };

  const blob = new Blob([JSON.stringify(manifest)], {type: 'application/json'});
  const manifestURL = URL.createObjectURL(blob);

  const link = document.createElement('link');
  link.rel = 'manifest';
  link.href = manifestURL;
  document.head.appendChild(link);

  const swCode = `
    self.addEventListener('install', e => {
      self.skipWaiting();
    });
    self.addEventListener('fetch', e => {});
  `;

  const swBlob = new Blob([swCode], {type: 'application/javascript'});
  const swURL = URL.createObjectURL(swBlob);

  navigator.serviceWorker.register(swURL);
}
</script>

</body>
</html>
