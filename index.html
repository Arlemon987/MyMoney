<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Money</title>

<meta name="theme-color" content="#764ba2">
<meta name="apple-mobile-web-app-capable" content="yes">
<link rel="apple-touch-icon" href="icon.png">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

<style>
*{box-sizing:border-box}
body{
margin:0;
font-family:Segoe UI;
background:linear-gradient(135deg,#667eea,#764ba2);
overflow-x:hidden;
}

/* LOCK SCREEN */

.lock-screen{
position:fixed;
top:0;left:0;
width:100%;height:100%;
background:linear-gradient(135deg,#1e3c72,#2a5298);
display:flex;
align-items:center;
justify-content:center;
z-index:9999;
}

.lock-box{
background:rgba(255,255,255,0.1);
backdrop-filter:blur(20px);
padding:40px;
border-radius:20px;
width:90%;
max-width:350px;
text-align:center;
color:white;
box-shadow:0 20px 40px rgba(0,0,0,0.3);
animation:fadeIn .4s ease;
}

@keyframes fadeIn{
from{opacity:0;transform:scale(.95)}
to{opacity:1;transform:scale(1)}
}

.lock-box h2{margin-bottom:20px}

.lock-box input{
width:100%;
padding:12px;
border:none;
border-radius:10px;
margin-bottom:15px;
font-size:16px;
}

.lock-btn{
width:100%;
padding:12px;
border:none;
border-radius:10px;
font-weight:bold;
cursor:pointer;
margin-bottom:10px;
}

.primary{background:#1cc88a;color:white}
.secondary{background:#36b9cc;color:white}

/* APP */

.container{max-width:1000px;margin:auto;padding:20px}
.section{
background:white;
padding:20px;
border-radius:16px;
margin-bottom:20px;
box-shadow:0 8px 20px rgba(0,0,0,0.08)
}

.summary-grid{
display:grid;
gap:15px;
grid-template-columns:repeat(auto-fit,minmax(250px,1fr))
}

.card{padding:15px;border-radius:12px;color:white}
.daily{background:#36b9cc}
.weekly{background:#f6c23e}
.monthly{background:#e74a3b}

button{
padding:10px;
border:none;
border-radius:8px;
font-weight:bold;
cursor:pointer
}

.income-btn{background:#1cc88a;color:white}
.expense-btn{background:#e74a3b;color:white}
.reset-btn{background:#6c757d;color:white;width:100%;margin-top:10px}

canvas{max-width:100%}
</style>
</head>
<body>

<div id="lockScreen" class="lock-screen">
<div class="lock-box">
<h2 id="lockTitle">Set Security PIN</h2>
<input type="password" id="pinInput" placeholder="Enter 4 digit PIN">
<button class="lock-btn primary" onclick="handleLock()">Continue</button>
<button class="lock-btn secondary" onclick="unlockBiometric()" id="bioBtn">Use Face ID</button>
</div>
</div>

<div class="container" id="appContent" style="display:none">

<h1 style="color:white;text-align:center">My Money</h1>

<div class="section">
<h3>Summary</h3>
<div class="summary-grid">
<div class="card daily">
<p>Income: <span id="dailyIncome">0</span></p>
<p>Expense: <span id="dailyExpense">0</span></p>
<p>Balance: <span id="dailyBalance">0</span></p>
</div>
<div class="card weekly">
<p>Income: <span id="weeklyIncome">0</span></p>
<p>Expense: <span id="weeklyExpense">0</span></p>
<p>Balance: <span id="weeklyBalance">0</span></p>
</div>
<div class="card monthly">
<p>Income: <span id="monthlyIncome">0</span></p>
<p>Expense: <span id="monthlyExpense">0</span></p>
<p>Balance: <span id="monthlyBalance">0</span></p>
</div>
</div>
</div>

<div class="section">
<form onsubmit="addIncome(event)">
<input type="number" id="incomeAmount" placeholder="Income Amount" required>
<button class="income-btn">Add Income</button>
</form>

<form onsubmit="addExpense(event)">
<input type="number" id="expenseAmount" placeholder="Expense Amount" required>
<button class="expense-btn">Add Expense</button>
</form>

<button class="reset-btn" onclick="resetTransactions()">Reset Transactions</button>
</div>

<div class="section">
<canvas id="chart"></canvas>
</div>

</div>

<script>

let profile=JSON.parse(localStorage.getItem("profile"))||{pin:null}
let encrypted=localStorage.getItem("transactions")
let transactions=[]

if(encrypted && profile.pin){
try{
let bytes=CryptoJS.AES.decrypt(encrypted,profile.pin)
transactions=JSON.parse(bytes.toString(CryptoJS.enc.Utf8))
}catch(e){transactions=[]}
}

function handleLock(){
let entered=pinInput.value

if(!profile.pin){
if(entered.length<4){alert("Enter minimum 4 digits");return}
profile.pin=entered
localStorage.setItem("profile",JSON.stringify(profile))
unlockApp()
}else{
if(entered===profile.pin){
unlockApp()
}else{
alert("Wrong PIN")
}
}
}

function unlockApp(){
lockScreen.style.display="none"
appContent.style.display="block"
render()
}

async function unlockBiometric(){
if(!profile.pin){alert("Set PIN first");return}
if(window.PublicKeyCredential){
try{
await navigator.credentials.get({
publicKey:{
challenge:new Uint8Array(32),
timeout:60000,
userVerification:"required"
}
})
unlockApp()
}catch(e){alert("Authentication Failed")}
}else alert("Not Supported")
}

function saveData(){
let cipher=CryptoJS.AES.encrypt(JSON.stringify(transactions),profile.pin).toString()
localStorage.setItem("transactions",cipher)
}

function addIncome(e){
e.preventDefault()
transactions.push({type:"income",amount:parseFloat(incomeAmount.value),date:new Date()})
saveData()
render()
}

function addExpense(e){
e.preventDefault()
transactions.push({type:"expense",amount:parseFloat(expenseAmount.value),date:new Date()})
saveData()
render()
}

function resetTransactions(){
if(confirm("Delete all transactions?")){
transactions=[]
localStorage.removeItem("transactions")
render()
}
}

function render(){
let today=new Date()
let weekAgo=new Date();weekAgo.setDate(today.getDate()-7)
let dI=0,dE=0,wI=0,wE=0,mI=0,mE=0

transactions.forEach(tx=>{
let txDate=new Date(tx.date)
if(txDate.toDateString()===today.toDateString())
tx.type==="income"?dI+=tx.amount:dE+=tx.amount
if(txDate>=weekAgo)
tx.type==="income"?wI+=tx.amount:wE+=tx.amount
if(txDate.getMonth()===today.getMonth())
tx.type==="income"?mI+=tx.amount:mE+=tx.amount
})

dailyIncome.innerText=dI
dailyExpense.innerText=dE
dailyBalance.innerText=dI-dE

weeklyIncome.innerText=wI
weeklyExpense.innerText=wE
weeklyBalance.innerText=wI-wE

monthlyIncome.innerText=mI
monthlyExpense.innerText=mE
monthlyBalance.innerText=mI-mE

renderChart(mI,mE)
}

function renderChart(i,e){
if(window.myChart)window.myChart.destroy()
window.myChart=new Chart(chart,{
type:"doughnut",
data:{labels:["Income","Expense"],
datasets:[{data:[i,e],backgroundColor:["#1cc88a","#e74a3b"]}]}
})
}

if(profile.pin){
document.getElementById("lockTitle").innerText="Unlock My Money"
}else{
document.getElementById("bioBtn").style.display="none"
}

</script>
</body>
</html>
